<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>UNDRA – Heldenbrief</title>

<!-- CSS: füge den kompletten CSS‑Block direkt nach diesem Kommentar ein -->

<style>
/* ===== SEITE 3 – LAYOUT ===== */

#step-3 {
    padding: 10px;
}

/* Zeilen-Panel */
.s3-panel {
    border: 1px solid gold;
    margin: 8px 10px;
    border-radius: 6px;
    background: rgba(0,0,0,.35);
    padding: 8px 10px;
}

/* Kopfzeile Seite 3 */
/* =========================================
   Außencontainer
   ========================================= */
#undra-header {
  width: 950px;
  height: 100px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto 6px auto;
  padding: 2px 0;
  box-sizing: border-box;
}

/* =========================================
   Innenbanner – jetzt mit sichtbarer Umrandung
   ========================================= */
.undra-banner {
  width: 475px;
  height: 75px;

  background: linear-gradient(to right,
      rgba(25, 25, 35, 0.95),
      rgba(15, 15, 25, 0.9)
  );

  border: 2px solid rgba(255, 215, 100, 0.7);   /* deutliche goldene Umrandung */
  border-radius: 6px;

  box-shadow:
    0 0 8px rgba(255, 215, 100, 0.35),          /* äußerer Glow */
    inset 0 0 6px rgba(255, 215, 100, 0.25);    /* innerer Glow */

  padding: 2px 8px;
  text-align: center;
  box-sizing: border-box;
}

/* =========================================
   Titel
   ========================================= */
.undra-title {
  font-size: 30px;
  font-weight: bold;
  color: gold;
  text-shadow:
    0 0 6px rgba(255, 215, 100, 0.7),
    0 0 12px rgba(255, 215, 100, 0.4);
  letter-spacing: 0.5px;
  margin-top: -2px;
}

/* =========================================
   Untertitel (Name + Titel)
   ========================================= */
.undra-subtitle {
  font-size: 25px;
  font-family: 'Segoe Script', 'Dancing Script', cursive;
  color: #ddd;
  margin-top: -1px;
  opacity: 0.85;
  letter-spacing: 0.3px;
}



/* Zeile 2: Merkmale / Portrait / SP */
.s3-row-flex {
    display: flex;
    gap: 10px;
    align-items: stretch;
}

.s3-col {
    flex: 1;
}

.s3-col-fixed {
    width: 180px;
}

/* Merkmalsblock */
.s3-hero-summary {
    border: 1px solid gold;
    padding: 6px;
    border-radius: 6px;
    font-size: 13px;
}

/* SP Anzeige */
.s3-sp-box {
    border: 1px solid gold;
    border-radius: 6px;
    padding: 6px;
    text-align: center;
    margin-top: 8px;
    font-size: 13px;
}

.s3-sp-value {
    color: #ffe7a8;
    font-weight: bold;
    text-shadow: 0 0 6px rgba(255,215,0,0.5);
}





/* Attribute (Zeile 3) – Raster einfach gehalten */
.s3-attr-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 4px 12px;
    font-size: 12px;
}

.s3-attr-row {
    display: grid;
    grid-template-columns: 1.2fr 24px 26px;
    gap: 4px;
    align-items: center;
}

.s3-attr-name {
    white-space: nowrap;
}

.s3-attr-value {
    border: 1px solid gold;
    text-align: center;
    padding: 2px;
    font-size: 11px;
}

.s3-attr-arrow {
    opacity: 0;
    cursor: default;
    transition: 0.2s ease;
    font-size: 16px;
    text-align: center;
    color: gold;
    text-shadow: 0 0 6px rgba(255,215,0,0.7);
}

.s3-attr-arrow.active {
    opacity: 1;
    cursor: pointer;
}



/* Zeile 4: Vitalwerte */
.s3-vital-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px 20px;
    font-size: 13px;
}

.s3-vital-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.s3-vital-btn {
    padding: 2px 8px;
    font-size: 11px;
    border-radius: 10px;
    border: 1px solid gold;
    background: #130707;
    color: gold;
    cursor: pointer;
}

.s3-vital-btn[disabled] {
    opacity: 0.4;
    cursor: not-allowed;
}

/* Zeile 5: Kampfblock */
.s3-combat-layout {
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    gap: 10px;
}

.s3-combat-grid {
    display: grid;
    grid-template-columns: 1fr 40px;
    gap: 4px 8px;
    font-size: 12px;
}

.s3-txtarea {
    width: 100%;
    min-height: 60px;
    resize: vertical;
    background: #050306;
    color: #eaddca;
    border: 1px solid #444;
    border-radius: 4px;
    font-family: Georgia, serif;
    font-size: 12px;
    padding: 4px;
}

.s3-hitzones-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 4px;
    font-size: 11px;
    text-align: center;
}

.s3-hitzone-cell {
    border: 1px solid #444;
    padding: 2px;
    border-radius: 4px;
}

.s3-diagram-box,
.s3-figure-box,
.s3-orb-box {
    border: 1px solid #333;
    border-radius: 6px;
    background: #050306;
    text-align: center;
    padding: 6px;
    font-size: 11px;
    color: #aaa;
}

/* Zeile 6: Fähigkeiten */
.s3-skill-section-title {
    font-size: 14px;
    color: #ffe7a8;
    margin-bottom: 4px;
}

.s3-skill-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 4px 8px;
    font-size: 11px;
}

.s3-skill-row {
    border: 1px solid #333;
    border-radius: 4px;
    padding: 3px 4px;
    display: grid;
    grid-template-columns: 1.2fr 30px 46px;
    gap: 2px;
    align-items: center;
}

.s3-skill-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.s3-skill-level {
    text-align: center;
}

.s3-skill-btn {
    font-size: 10px;
    padding: 2px 4px;
    border-radius: 8px;
    border: 1px solid gold;
    background: #160909;
    color: gold;
    cursor: pointer;
}

.s3-skill-btn[disabled] {
    opacity: 0.35;
    cursor: not-allowed;
}

/* Zeile 7: Inventar (einfaches Grid) */
.s3-inventory-grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 4px;
    font-size: 10px;
}

.s3-inventory-slot {
    border: 1px solid #333;
    border-radius: 4px;
    height: 32px;
    background: #050306;
}

/* Zeile 8: Prozentanzeige */
.s3-percent-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
    font-size: 11px;
}

.s3-percent-row {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.s3-progress-bar {
    width: 100%;
    height: 6px;
    background: #222;
    border-radius: 4px;
    overflow: hidden;
}

.s3-progress-fill {
    height: 100%;
    background: linear-gradient(90deg,#7a121b,#f3e3a2);
}

/* Zeile 9: Timeline */
.s3-timeline-grid {
    display: grid;
    grid-template-columns: repeat(30, 1fr);
    gap: 2px;
    font-size: 9px;
}

.s3-day-btn {
    padding: 3px 0;
    border-radius: 4px;
    border: 1px solid #444;
    text-align: center;
    cursor: default;
    background: #050306;
    color: #aaa;
}

.s3-day-btn.active {
    border-color: gold;
    color: #ffe7a8;
    box-shadow: 0 0 6px rgba(255,215,0,0.4);
}

.s3-day-btn.checked {
    background: linear-gradient(135deg,#004400,#001a00);
    border-color: #00aa44;
    color: #88ff88;
    box-shadow:
        0 0 8px rgba(0,255,120,0.5),
        inset 0 0 6px rgba(0,255,120,0.4);
}







/* ============================
GLOBAL
============================ */
/* ============================
GLOBAL – UNDRA BLOODCORE R2
============================ */
body {
    background: #050307;
    color: #f5f1ff;
    font-family: "Georgia", serif;

    margin: 0;
    padding: 20px 0;
    box-sizing: border-box;

    background-image:
        radial-gradient(circle at 20% 20%, rgba(255, 60, 60, 0.08), transparent 60%),
        radial-gradient(circle at 80% 80%, rgba(255, 200, 80, 0.06), transparent 60%);
}

#undra-alert.hidden {
  display: none !important;
}

#undra-alert .uf-popup {
  background:#120a12;
  border:2px solid gold;
  border-radius:10px;
  padding:16px;
  width:360px;
  color:#ffe7c2;
  box-shadow:
    0 0 22px rgba(0,0,0,1),
    0 0 18px rgba(255,60,60,0.45),
    inset 0 0 12px rgba(255,200,80,0.18);
}

/* ============================
ANMERKUNG – BOX (Bloodcore R2)
============================ */
#anmerkungBlock {
    width: 450px;
    max-width: 100%;
    margin: 30px auto 0 auto;

    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;

    border-radius: 6px;
    padding: 16px 18px;

    display: flex;
    flex-direction: column;
    gap: 10px;

    box-shadow:
        0 0 28px rgba(0,0,0,1),
        0 0 26px rgba(255, 60, 60, 0.55),
        0 0 18px rgba(255, 200, 80, 0.45),
        inset 0 0 18px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);
}
/* ============================
ANMERKUNG – TITEL (Bloodcore R2)
============================ */
.anmerkung-title {
    font-size: 18px;
    font-weight: bold;
    color: #ffe9b4;

    letter-spacing: 0.6px;
    padding-bottom: 6px;
    margin-bottom: 10px;

    border-bottom: 1px solid rgba(255, 210, 120, 0.6);

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 10px rgba(255, 60, 60, 0.4);
}

/* ============================
ANMERKUNG – TEXTFELD (Bloodcore R2)
============================ */
#anmerkungText {
    width: 100%;
    height: 140px;

    background: rgba(10, 4, 6, 0.92);
    border: 2px solid #603020;
    border-radius: 4px;

    color: #fff8e8;
    padding: 10px;
    resize: none;

    font-family: "Georgia", serif;
    font-size: 14px;
    line-height: 1.4;

    box-shadow:
        inset 0 0 6px rgba(0,0,0,0.9),
        inset 0 0 10px rgba(255, 0, 40, 0.25);
}

#anmerkungText::placeholder {
    color: #b38c76;
}

/* ============================
ANMERKUNG – COUNTER (Bloodcore R2)
============================ */
#anmerkungCounter {
    font-size: 12px;
    color: #f7dfaf;
    text-align: right;
    opacity: 0.9;

    letter-spacing: 0.3px;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);
}

/* ============================
KOPFZEILE – TITEL "Heldenbrief"
============================ */
#heldenbriefBanner {
    width: 600px;
    height: 160px;
    margin: 30px auto 0 auto;

    /* HIER DEIN PINTEREST-BANNER EINSETZEN */
    background-image: url('https://pin.it/6yLWAkUDB');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;

    display: flex;
    justify-content: center;
    align-items: center;

    position: relative;
}

/* Textblock */
.heldenbriefText {
    text-align: center;
    padding: 10px 20px;
}

/* Titel */
.heldenbriefTitel {
    font-size: 28px;
    font-weight: bold;
    font-family: "Georgia", serif;
    color: #ffe9c4;
    font-style: italic;
    line-height: 1.3;

    text-shadow:
        0 0 6px rgba(255, 200, 80, 0.7),
        0 0 14px rgba(140, 80, 255, 0.45);
}

/* Name */
.heldenbriefName {
    margin-top: 4px;
    font-size: 20px;
    font-family: "Georgia", serif;
    color: #f5f1ff;
    font-style: italic;
    line-height: 1.3;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.5),
        0 0 10px rgba(106, 13, 173, 0.3);
}
.heldenbriefName {
    margin-top: 4px;
    font-size: 20px;
    font-family: "Georgia", serif;
    color: #f5f1ff;
    font-style: italic;
    line-height: 1.3;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.5),
        0 0 10px rgba(106, 13, 173, 0.3);
}


/* ============================
KOPFZEILE – NAME (Bloodcore R2)
============================ */
#hero-header {
    text-align: center;
    height: 160px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    margin-bottom: 25px;
}

#hero-title-main {
    font-size: 40px;
    font-weight: 700;
    color: #ffe9c4;
    font-style: italic;
    text-shadow:
        0 0 6px rgba(255, 200, 80, 0.7),
        0 0 14px rgba(140, 80, 255, 0.45);
    letter-spacing: 2px;
}

#hero-title-name {
    margin-top: 6px;
    font-size: 22px;
    color: #ffffff;
    opacity: 0.9;
    letter-spacing: 1px;
}


/* =========================================
   UNDRA – Topbar unter dem Header
   ========================================= */
#undra-topbar {
  width: 950px;
  height: 28px;
  margin: 4px auto 10px auto;

  display: flex;
  justify-content: space-between;
  align-items: center;

  padding: 2px 4px;
  box-sizing: border-box;

  background: rgba(20, 20, 30, 0.85);
  border: 1px solid rgba(255, 215, 100, 0.4);
  border-radius: 6px;

  box-shadow:
    0 0 6px rgba(255, 215, 100, 0.25),
    inset 0 0 4px rgba(255, 215, 100, 0.15);
}

.undra-btn {
  padding: 6px 12px;
  background: #3a2b4d;
  color: #f0e6ff;
  border: 1px solid #7c5ca3;
  border-radius: 4px;
  font-family: inherit;
  cursor: pointer;
}

/* Popup Hintergrund */
.undra-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5, 5, 10, 0.75);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5000;
}

.hidden {
  display: none;
}

/* Popup Box */
.undra-popup-inner {
  width: 300px;
  padding: 16px;
  background: rgba(20, 20, 30, 0.95);
  border: 2px solid gold;
  border-radius: 8px;
  box-shadow:
    0 0 12px rgba(255, 215, 100, 0.4),
    inset 0 0 8px rgba(255, 215, 100, 0.25);
  text-align: center;
}

/* Titel */
.undra-popup-title {
  font-size: 18px;
  font-weight: bold;
  color: gold;
  margin-bottom: 12px;
  text-shadow: 0 0 6px rgba(255, 215, 100, 0.6);
}

/* Inventar Zeilen */
.inv-row {
  display: flex;
  justify-content: space-between;
  padding: 6px 4px;
  margin-bottom: 6px;
  background: rgba(30, 30, 40, 0.8);
  border: 1px solid rgba(255, 215, 100, 0.3);
  border-radius: 4px;
}

.inv-label {
  color: #ddd;
  font-size: 14px;
}

.inv-count {
  color: gold;
  font-weight: bold;
  font-size: 14px;
}

.inv-category {
  padding: 12px;
  border: 1px solid #444;
  background: #1a1a1a;
  border-radius: 6px;
  margin-bottom: 12px;
  transition: all 0.3s ease;
}

.inv-category.active {
  border-color: #cfaaff;
  box-shadow: 0 0 12px #cfaaff;
}

/* Close Button */
.undra-popup-close {
  margin-top: 12px;
  padding: 4px 12px;
  background: rgba(30, 30, 40, 0.9);
  border: 1px solid gold;
  border-radius: 4px;
  color: gold;
  cursor: pointer;
  transition: 0.2s ease;
}

.undra-popup-close:hover {
  background: rgba(255, 215, 100, 0.15);
  box-shadow: 0 0 6px gold;
}

.undra-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5, 5, 10, 0.75);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5000;
}

.hidden {
  display: none;
}

.undra-popup-inner {
  width: 300px;
  padding: 16px;
  background: rgba(20, 20, 30, 0.95);
  border: 2px solid gold;
  border-radius: 8px;
  box-shadow:
    0 0 12px rgba(255, 215, 100, 0.4),
    inset 0 0 8px rgba(255, 215, 100, 0.25);
  text-align: center;
}

.undra-popup-title {
  font-size: 18px;
  font-weight: bold;
  color: gold;
  margin-bottom: 12px;
  text-shadow: 0 0 6px rgba(255, 215, 100, 0.6);
}

.inv-row {
  display: flex;
  justify-content: space-between;
  padding: 6px 4px;
  margin-bottom: 6px;
  background: rgba(30, 30, 40, 0.8);
  border: 1px solid rgba(255, 215, 100, 0.3);
  border-radius: 4px;
}

.inv-label {
  color: #ddd;
  font-size: 14px;
}

.inv-count {
  color: gold;
  font-weight: bold;
  font-size: 14px;
}

.undra-popup-close {
  margin-top: 12px;
  padding: 4px 12px;
  background: rgba(30, 30, 40, 0.9);
  border: 1px solid gold;
  border-radius: 4px;
  color: gold;
  cursor: pointer;
  transition: 0.2s ease;
}

.undra-popup-close:hover {
  background: rgba(255, 215, 100, 0.15);
  box-shadow: 0 0 6px gold;
}

/* =========================================
   Buttons
   ========================================= */
.undra-top-btn {
  height: 22px;
  padding: 0 10px;

  background: rgba(30, 30, 40, 0.9);
  border: 1px solid rgba(255, 215, 100, 0.4);
  border-radius: 4px;

  color: gold;
  font-size: 12px;
  font-weight: bold;

  cursor: pointer;
  transition: 0.2s ease;

  text-shadow: 0 0 4px rgba(255, 215, 100, 0.5);
}

.inv-item.glow {
  outline: 2px solid #cfaaff;
  box-shadow: 0 0 8px #cfaaff;
  border-radius: 4px;
  transition: box-shadow 0.2s ease;
}

/* Hover */
.undra-top-btn:hover {
  background: rgba(255, 215, 100, 0.15);
  border-color: gold;
  box-shadow:
    0 0 6px rgba(255, 215, 100, 0.4),
    inset 0 0 4px rgba(255, 215, 100, 0.2);
  transform: translateY(-1px);
}


/* ============================
DREIER-LINIE – Bloodcore R2
============================ */
#merkmale-row {
    width: 950px;
    max-width: 950px;
    margin: 0 auto 24px auto;

    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-start;
    gap: 20px;

    padding-top: 6px;
    border-top: 1px solid rgba(255, 210, 120, 0.4);
    box-sizing: border-box;
}





/* ============================
MERKMALE LINKS – Bloodcore R2
============================ */
#merkmale-links {
    flex: 1;
    min-width: 475px;
    max-width: 530px;

    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;

    border-radius: 6px;
    padding: 16px 18px;

    box-shadow:
        0 0 28px rgba(0,0,0,1),
        0 0 26px rgba(255, 60, 60, 0.55),
        0 0 18px rgba(255, 200, 80, 0.45),
        inset 0 0 18px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);

    box-sizing: border-box;
}

/* ============================
MERKMALE – TITEL (Bloodcore R2)
============================ */
.merk-title {
    text-align: center;
    font-size: 18px;
    font-weight: bold;

    color: #ffe9b4;
    letter-spacing: 0.6px;

    border-bottom: 1px solid rgba(255, 210, 120, 0.6);
    padding-bottom: 6px;
    margin-bottom: 12px;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 10px rgba(255, 60, 60, 0.4);
}

/* ============================
MERKMALE – GRID (Bloodcore R2)
============================ */
.merk-list {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px 20px;
    width: 100%;
    box-sizing: border-box;
}

/* ============================
MERKMAL – EINZELFELD (Bloodcore R2)
============================ */
.merk-item {
    position: relative;

    background: rgba(10, 4, 6, 0.92);
    padding: 10px 14px;
    border-radius: 4px;

    border: 1px solid #8a5200;
    box-shadow:
        inset 0 0 6px rgba(0,0,0,0.9),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        0 0 8px rgba(255, 60, 60, 0.25);

    display: flex;
    justify-content: space-between;
    align-items: center;

    font-size: 14px;
    color: #ffe9d8;

    box-sizing: border-box;
}

/* ============================
MERKMAL – ECKEN-ORNAMENTE (Bloodcore R2)
============================ */
.merk-item::before,
.merk-item::after {
    content: "";
    position: absolute;
    width: 12px;
    height: 12px;

    border: 1px solid #e2b44a;
    opacity: 0.9;
}

.merk-item::before {
    top: -3px;
    left: -3px;
    border-right: none;
    border-bottom: none;
    border-radius: 3px 0 0 0;
}

.merk-item::after {
    bottom: -3px;
    right: -3px;
    border-left: none;
    border-top: none;
    border-radius: 0 0 3px 0;
}

/* ============================
MERKMAL – LABEL LINKS (Bloodcore R2)
============================ */
.merk-item span:first-child {
    color: #ffe9b4;
    font-weight: bold;
    letter-spacing: 0.4px;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);
}
/* ============================
PORTRAIT – DSA Retro
============================ */
#portrait-block {
    flex: 1;
    min-width: 200px;
    max-width: 260px;

    background: #f2e9d8;                 /* Pergament */
    border: 2px solid #5a4633;           /* dunkles Sepia */
    border-radius: 4px;

    padding: 12px 14px;
    position: relative;

    display: flex;
    flex-direction: column;
    justify-content: center;

    box-shadow:
        0 2px 4px rgba(0,0,0,0.15),
        inset 0 0 2px rgba(255,255,255,0.4); /* Papierstruktur */
    box-sizing: border-box;
}

/* Rahmen-Ornament */
#portrait-block::before {
    content: "";
    position: absolute;
    inset: 6px;
    border: 1px solid #bfa98a;           /* warmes Sepia */
    border-radius: 3px;
    opacity: 0.8;
    pointer-events: none;
}





/* ============================
PORTRAIT – INNENBEREICH (Bloodcore R2)
============================ */
#portrait-inner {
    width: 100%;
    aspect-ratio: 3 / 4;
    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border-radius: 6px;
    overflow: hidden;

    display: flex;
    justify-content: center;
    align-items: center;

    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;

    box-shadow:
        0 0 22px rgba(0,0,0,1),
        0 0 18px rgba(255, 60, 60, 0.45),
        inset 0 0 16px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);

    box-sizing: border-box;
}





/* Bild */
#portrait-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
}

/* Platzhalter */
#portrait-placeholder {
    width: 100%;
    height: 100%;
    color: #ffe9c4;
    font-size: 14px;
    opacity: 0.8;

    display: flex;
    justify-content: center;
    align-items: center;

    text-shadow:
        0 0 6px rgba(255, 200, 80, 0.7),
        0 0 12px rgba(255, 60, 60, 0.4);
}

/* ============================
DIAGRAMM – AUSSENBLOCK (Bloodcore R2)
============================ */
#diagramm-block {
    flex: 1;
    min-width: 180px;
    max-width: 240px;

    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;

    border-radius: 6px;
    padding: 12px 14px;
    position: relative;

    display: flex;
    flex-direction: column;
    justify-content: center;

    box-shadow:
        0 0 26px rgba(0,0,0,1),
        0 0 20px rgba(255, 60, 60, 0.45),
        0 0 14px rgba(255, 200, 80, 0.35),
        inset 0 0 14px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);

    box-sizing: border-box;
}

/* ============================
DIAGRAMM – ZIERLINIEN (Bloodcore R2)
============================ */
#diagramm-block::before,
#diagramm-block::after {
    content: "";
    position: absolute;
    left: 0;
    width: 100%;
    height: 1px;

    background: linear-gradient(
        to right,
        rgba(255, 210, 120, 0.8),
        rgba(255, 60, 60, 0.6),
        rgba(255, 210, 120, 0.8)
    );
}

#diagramm-block::before {
    top: -6px;
}

#diagramm-block::after {
    bottom: -6px;
}

/* ============================
DIAGRAMM – INNENBEREICH (Bloodcore R2)
============================ */
#diagramm-inner {
    width: 100%;
    aspect-ratio: 1 / 1;

    background: rgba(10, 4, 6, 0.92);
    border: 1px solid #8a5200;
    border-radius: 4px;

    overflow: hidden;

    display: flex;
    justify-content: center;
    align-items: center;

    box-shadow:
        inset 0 0 10px rgba(0,0,0,0.9),
        inset 0 0 14px rgba(255, 0, 40, 0.25),
        inset 0 0 6px rgba(255, 200, 80, 0.25);

    box-sizing: border-box;
}

/* ============================
ATTRIBUTE-BLOCK – Bloodcore R2
============================ */
#attribute-block {
    width: 950px;
    height: 400px;

    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;

    border-radius: 6px;
    padding: 14px 16px;
    box-sizing: border-box;
    position: relative;
    margin: 0 auto 30px auto;

    box-shadow:
        0 0 28px rgba(0,0,0,1),
        0 0 26px rgba(255, 60, 60, 0.55),
        0 0 18px rgba(255, 200, 80, 0.45),
        inset 0 0 18px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);
}

/* ============================
ATTRIBUTE – TITEL (Bloodcore R2)
============================ */
#attribute-title {
    text-align: center;
    font-size: 20px;
    font-weight: bold;

    color: #ffe9b4;
    letter-spacing: 0.8px;

    border-bottom: 1px solid rgba(255, 210, 120, 0.6);
    padding-bottom: 6px;
    margin-bottom: 12px;

    text-shadow:
        0 0 6px rgba(255, 200, 80, 0.7),
        0 0 14px rgba(255, 60, 60, 0.45);
}

/* ============================
ATTRIBUTE – GRID
============================ */
#attribute-grid {
    display: auto;
    flex-direction: auto;
    gap: 6px;
    height: calc(100% - 34px);
}

.row {
    display: grid;
    grid-template-columns: auto(17 fr);
    gap: 6px;
}

.center-row {
    display: flex;
    justify-content: center;
    gap: 40px;
}





/* ============================
ATTRIBUTE – SLOT (Bloodcore R2)
============================ */
.attribute-slot {
    background: rgba(10, 4, 6, 0.92);
    border: 1px solid #8a5200;
    border-radius: 4px;

    padding: 4px 16px;
    display: grid;
    grid-template-columns: 2fr auto auto;
    align-items: center;

    font-size: 17px;
    color: #ffe9d8;

    box-shadow:
        inset 0 0 10px rgba(0,0,0,0.9),
        inset 0 0 14px rgba(255, 0, 40, 0.25),
        inset 0 0 6px rgba(255, 200, 80, 0.25),
        0 0 8px rgba(255, 60, 60, 0.25);
}

/* ============================
ATTRIBUTE – LEVEL (Bloodcore R2)
============================ */
.attr-level {
    color: #ffe9b4;
    font-weight: bold;
    margin-right: 4px;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);
}

/* ============================
ATTRIBUTE – PFEILE (Bloodcore R2)
============================ */
.attr-arrow {
    width: 18px;
    height: 18px;

    background: rgba(10, 4, 6, 0.92);
    border: 1px solid #8a5200;
    border-radius: 3px;

    color: #ffe9b4;
    cursor: pointer;

    display: flex;
    justify-content: center;
    align-items: center;

    font-weight: bold;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);

    box-shadow:
        inset 0 0 6px rgba(0,0,0,0.9),
        inset 0 0 10px rgba(255, 0, 40, 0.25);
}

.attr-arrow:hover {
    background: rgba(40, 10, 10, 0.95);
    border-color: #ffe9a8;
    color: #ffe9a8;

    box-shadow:
        0 0 10px rgba(255, 200, 80, 0.8),
        0 0 14px rgba(255, 60, 60, 0.5),
        inset 0 0 10px rgba(255, 200, 80, 0.25);
}
/* ============================
VITALWERTE + AUFWERTUNGEN – UNDRA Bloodcore R2
============================ */
#vitalWrapper {
    width: 950px;
    margin: 0 auto 40px auto;

    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* ============================
VITALWERTE – BOXEN (Bloodcore R2)
============================ */
#vitalDisplay,
#vitalBonusPanel {
    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;
    border-radius: 6px;

    padding: 16px 18px;
    box-sizing: border-box;

    box-shadow:
        0 0 28px rgba(0,0,0,1),
        0 0 26px rgba(255, 60, 60, 0.55),
        0 0 18px rgba(255, 200, 80, 0.45),
        inset 0 0 18px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);
}








/* ============================
VITALWERTE – TITEL (Bloodcore R2)
============================ */
.vital-title {
    text-align: center;
    font-size: 20px;
    font-weight: 700;

    color: #ffe9b4;
    letter-spacing: 1px;

    border-bottom: 1px solid rgba(255, 210, 120, 0.6);
    padding-bottom: 6px;
    margin-bottom: 14px;

    text-shadow:
        0 0 6px rgba(255, 200, 80, 0.7),
        0 0 14px rgba(255, 60, 60, 0.45);
}

/* ============================
VITALWERTE – EINZELZEILE (Bloodcore R2)
============================ */
.vital-row {
    display: grid;
    grid-template-columns: 40px 1fr auto;
    align-items: center;

    padding: 6px 6px;
    margin-bottom: 10px;

    background: rgba(10, 4, 6, 0.92);
    border-radius: 4px;
    border: 1px solid #8a5200;

    box-shadow:
        inset 0 0 10px rgba(0,0,0,0.9),
        inset 0 0 14px rgba(255, 0, 40, 0.25),
        inset 0 0 6px rgba(255, 200, 80, 0.25),
        0 0 8px rgba(255, 60, 60, 0.25);
}

/* ============================
VITALWERTE – ICON (Bloodcore R2)
============================ */
.vital-icon {
    font-size: 22px;
    text-align: center;
    color: #ffe9b4;

    text-shadow:
        0 0 6px rgba(255, 200, 80, 0.7),
        0 0 12px rgba(255, 60, 60, 0.4);
}

/* ============================
VITALWERTE – LABEL (Bloodcore R2)
============================ */
.vital-label {
    color: #ffe9d8;
    font-weight: 600;
    font-size: 15px;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);
}

/* ============================
VITALWERTE – WERT (Bloodcore R2)
============================ */
.vital-value {
    color: #fff4e6;
    font-size: 15px;
    text-align: right;
    font-weight: bold;

    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);
}

/* ============================
ICON-ANIMATIONEN (unverändert)
============================ */
.heart { animation: heartPulse 1.8s infinite ease-in-out; }
@keyframes heartPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.12); }
    100% { transform: scale(1); }
}

.energy { animation: energyZap 1.4s infinite; }
@keyframes energyZap {
    0%, 90% { transform: translateX(0); }
    92% { transform: translateX(-2px); }
    94% { transform: translateX(2px); }
    96% { transform: translateX(-1px); }
    100% { transform: translateX(0); }
}

.shield { animation: shieldShine 3s infinite linear; }
@keyframes shieldShine {
    0% { filter: brightness(1); }
    50% { filter: brightness(1.35); }
    100% { filter: brightness(1); }
}

.brain { animation: brainWave 2.4s infinite ease-in-out; }
@keyframes brainWave {
    0% { filter: drop-shadow(0 0 2px #6a3f8f); }
    50% { filter: drop-shadow(0 0 8px #b57cff); }
    100% { filter: drop-shadow(0 0 2px #6a3f8f); }
}

.target { animation: targetPing 2.2s infinite ease-out; }
@keyframes targetPing {
    0% { transform: scale(1); opacity: 1; }
    70% { transform: scale(1.15); opacity: 0.6; }
    100% { transform: scale(1); opacity: 1; }
}





/* ============================
AUFWERTUNGEN – OPTIMIERTE ABSTÄNDE (Bloodcore R2)
============================ */

.vb-row {
    display: grid;
    grid-template-columns: 28px 1fr auto auto;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;

    min-height: 40px; /* sorgt für identische Zeilenhöhe */
}

/* Label links */
.vb-label {
    font-size: 0.85rem;
    color: #ffe9d8;
    line-height: 1;
    padding-top: 2px; /* optische Zentrierung */
}

/* Icon */
.vb-icon {
    font-size: 22px;
    width: 28px;
    text-align: center;
    color: #ffe9b4;

    display: flex;
    justify-content: center;
    align-items: center;

    text-shadow:
        0 0 6px rgba(255, 200, 80, 0.7),
        0 0 12px rgba(255, 60, 60, 0.4);
}

/* Crystal‑Reihe */
.vb-crystals {
    display: flex;
    gap: 6px;
    align-items: center; /* vertikale Zentrierung */
    height: 100%;
}

.vb-crystal {
    width: 36px;
    height: 12px;
    border-radius: 6px;
    background: rgba(40, 20, 20, 0.6);
    transition: 0.2s;
}








.vb-crystal.active {
    background: linear-gradient(90deg, #ffe9a8, #e2b44a);
    box-shadow:
        0 0 10px rgba(255, 200, 80, 0.9),
        0 0 14px rgba(255, 60, 60, 0.5);
}

/* Upgrade‑Button */
.vb-upgrade {
    background: linear-gradient(90deg, #ffe9a8, #e2b44a);
    border: 2px solid #8a5200;
    border-radius: 6px;
    cursor: pointer;
    padding: 4px 10px;

    font-size: 0.8rem;
    font-weight: 600;
    color: #111;

    display: flex;
    align-items: center;
    justify-content: center;

    height: 28px; /* exakt gleiche Höhe wie Icons */
    box-shadow:
        0 0 10px rgba(255, 200, 80, 0.8),
        0 0 14px rgba(255, 60, 60, 0.5);
}

.vb-upgrade:disabled {
    opacity: 0.4;
    cursor: default;
}

/* ============================
KAMPF + RÜSTUNGSSYSTEM – Bloodcore R2 (Fix)
============================ */
#kampfWrapper {
    width: 450px;
    max-width: 100%;
    margin: 0 auto 40px auto;

    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;

    box-sizing: border-box;
}

/* Alle Elemente im Wrapper dürfen NICHT breiter werden als die Spalte */
#kampfWrapper > div {
    display: flex;
    flex-direction: column;
    max-width: 100%;
    box-sizing: border-box;
}

/* ============================
LINKER BLOCK – ANGRIFF (Bloodcore R2)
============================ */
.kampf-panel {
    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;
    border-radius: 6px;

    padding: 14px 16px;
    min-height: 260px;

    display: flex;
    flex-direction: column;
    gap: 12px;

    box-shadow:
        0 0 26px rgba(0,0,0,1),
        0 0 20px rgba(255, 60, 60, 0.45),
        0 0 14px rgba(255, 200, 80, 0.35),
        inset 0 0 14px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);
}

/* Kampfzeilen */
.kampf-row {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;

    padding: 8px 8px;
    background: rgba(10, 4, 6, 0.92);
    border-radius: 4px;

    border: 1px solid #8a5200;
    box-shadow:
        inset 0 0 10px rgba(0,0,0,0.9),
        inset 0 0 14px rgba(255, 0, 40, 0.25),
        inset 0 0 6px rgba(255, 200, 80, 0.25),
        0 0 8px rgba(255, 60, 60, 0.25);
}

.kampf-label {
    color: #ffe9b4;
    font-weight: 700;
    font-size: 15px;
    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);
}

.kampf-value {
    color: #fff4e6;
    font-size: 15px;
    text-align: right;
    font-weight: bold;
    text-shadow:
        0 0 4px rgba(255, 200, 80, 0.7),
        0 0 8px rgba(255, 60, 60, 0.4);
}

/* ============================
RECHTER BLOCK – RÜSTUNGSSYSTEM (Bloodcore R2)
============================ */
#ruestungsBlock {
    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;
    border-radius: 6px;

    padding: 14px 16px;

    box-shadow:
        0 0 26px rgba(0,0,0,1),
        0 0 20px rgba(255, 60, 60, 0.45),
        0 0 14px rgba(255, 200, 80, 0.35),
        inset 0 0 14px rgba(255, 200, 80, 0.25),
        inset 0 0 10px rgba(255, 0, 40, 0.25),
        inset 0 0 4px rgba(255,255,255,0.08);
}








/* ============================
RÜSTUNGSSYSTEM – INNENBLOCK
============================ */
#armorSystem {
    width: 100%;              /* statt 475px */
    max-width: 100%;          /* verhindert Überbreite */
    background: rgba(10, 4, 6, 0.92);
    border: 1px solid #8a5200;
    border-radius: 6px;

    padding: 6px;             /* kompakter */
    font-size: 11px;
    color: #ffe9d8;
    font-family: "Georgia", serif;

    min-height: 260px;

    display: flex;
    flex-direction: row;
    justify-content: space-between; /* Männchen + Werte sauber verteilt */
    gap: 6px;

    box-sizing: border-box;   /* verhindert Überlaufen */
    overflow: hidden;         /* falls etwas minimal übersteht */
}



/* Linke Seite */
#armorLeft {
    width: 70%;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* ============================
ZONEN-AUSWAHL
============================ */
#zoneSelectGrid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px 20px;

    background: rgba(0,0,0,0.6);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #8a5200;

    box-shadow:
        inset 0 0 10px rgba(0,0,0,0.9),
        inset 0 0 14px rgba(255, 0, 40, 0.25);
}

#zoneSelectGrid div {
    padding: 6px 8px;
    background: rgba(40, 20, 20, 0.6);
    border-radius: 4px;
    cursor: pointer;
    transition: 0.15s ease;
    color: #ffe9d8;
}

#zoneSelectGrid div:hover {
    background: rgba(255, 200, 80, 0.15);
    transform: translateY(-1px);
}

#zoneSelectGrid div.active-zone {
    background: linear-gradient(90deg, #ffe9a8, #e2b44a);
    border: 1px solid #8a5200;
    color: #111;
    box-shadow:
        0 0 10px rgba(255, 200, 80, 0.9),
        0 0 14px rgba(255, 60, 60, 0.5);
}

/* Inputs */
#armorLeft input,
#armorLeft button {
    width: 100%;
    height: 22px;
    font-size: 11px;

    background: rgba(10, 4, 6, 0.92);
    border: 1px solid #8a5200;
    color: #ffe9d8;
    border-radius: 3px;

    box-shadow:
        inset 0 0 6px rgba(0,0,0,0.9),
        inset 0 0 10px rgba(255, 0, 40, 0.25);
}

/* Zonenliste */
#zoneList {
    flex: 1;
    font-size: 11px;
    line-height: 14px;
    color: #ffe9d8;
}

.zone-box {
    margin-bottom: 6px;
    padding-bottom: 4px;
    border-bottom: 1px solid #8a5200;
}





/* ============================
RECHTE SEITE – FIGUR
============================ */
#armorRight {
    width: 30%;
    background: #000;
    border: 1px solid #8a5200;
    border-radius: 4px;

    min-height: 260px;

    display: flex;
    justify-content: center;
    align-items: center;

    box-shadow:
        inset 0 0 10px rgba(0,0,0,0.9),
        inset 0 0 14px rgba(255, 0, 40, 0.25);
}

#zoneFigure {
    width: 100%;
    height: 100%;
}

/* ============================
SVG-ZONEN
============================ */
.armor-zone {
    fill: #4b5563;
    stroke: #8a5200;
    stroke-width: 2;
    transition: 0.2s ease;
    cursor: pointer;
}

.armor-zone:hover {
    filter: brightness(1.3);
    stroke: #ffe9a8;
}

.active-zone-svg {
    stroke: #ffe9a8 !important;
    stroke-width: 3 !important;
    filter: drop-shadow(0 0 6px #ffe9a8);
}






/* ============================
POPUP – Bloodcore R2
============================ */
.popup-bg {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.72);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    backdrop-filter: blur(4px);
}

/* sichtbarer Zustand (z.B. .popup-bg.active) */
.popup-bg.active {
    display: flex;
}

/* Popup-Karte */
.popup {
    width: 280px;
    max-width: calc(100% - 40px);
    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    color: #fff4e6;
    padding: 14px;
    border-radius: 8px;
    box-sizing: border-box;

    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;

    box-shadow:
        0 0 30px rgba(0,0,0,0.95),
        0 0 22px rgba(255,60,60,0.45),
        0 0 14px rgba(255,200,80,0.35),
        inset 0 0 12px rgba(255,200,80,0.18);

    font-size: 13px;
    line-height: 1.3;
    text-align: center;
}

/* Kopfzeile / Titel innerhalb des Popups (optional) */
.popup .title {
    font-weight: 700;
    color: #ffe9b4;
    margin-bottom: 8px;
    text-shadow:
        0 0 6px rgba(255,200,80,0.7),
        0 0 12px rgba(255,60,60,0.35);
}

/* Inhaltstext */
.popup p {
    margin: 0 0 10px 0;
    color: #fff1df;
}

/* Buttons */
.popup button {
    width: 100%;
    height: 34px;
    margin-top: 6px;
    padding: 6px 10px;
    border-radius: 6px;

    background: linear-gradient(90deg, #ffe9a8, #e2b44a);
    border: 2px solid #8a5200;
    color: #111;
    font-weight: 700;
    cursor: pointer;

    box-shadow:
        0 0 10px rgba(255,200,80,0.85),
        0 0 14px rgba(255,60,60,0.45),
        inset 0 0 6px rgba(255,255,255,0.12);
}

/* Button Hover / Focus */
.popup button:hover,
.popup button:focus {
    transform: translateY(-1px);
    box-shadow:
        0 0 14px rgba(255,200,80,0.95),
        0 0 18px rgba(255,60,60,0.55),
        inset 0 0 8px rgba(255,255,255,0.14);
    outline: none;
}

/* Sekundärer Button (z.B. Abbrechen) */
.popup .btn-secondary {
    background: rgba(10,4,6,0.92);
    color: #ffe9b4;
    border: 1px solid rgba(255,210,120,0.25);
    box-shadow:
        inset 0 0 6px rgba(0,0,0,0.9),
        0 0 8px rgba(255,60,60,0.18);
}

/* Accessibility: Fokus sichtbar */
.popup button:focus-visible {
    outline: 3px solid rgba(255,200,80,0.25);
    outline-offset: 2px;
}

/* ============================
INVENTAR, TIMELINE, FOOTER – Bloodcore R2
============================ */
#inventoryWrapper {
    width: 950px;
    margin: 0 auto 18px auto;
}

#inventoryPanel {
    display: flex;
    gap: 12px;
    justify-content: space-between;
}

/* Inventar Spalte */
.inv-column {
    width: 950px;
    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-image: linear-gradient(to bottom, #ffe9a8, #e2b44a, #8a5200) 1;
    padding: 10px;
    border-radius: 6px;
    box-sizing: border-box;
    color: #fff4e6;
    box-shadow:
        0 0 22px rgba(0,0,0,1),
        0 0 18px rgba(255,60,60,0.45),
        inset 0 0 12px rgba(255,200,80,0.18);
}

.inv-title {
    color: #ffe9b4;
    font-weight: bold;
    margin-bottom: 8px;
    text-shadow:
        0 0 6px rgba(255,200,80,0.7),
        0 0 10px rgba(255,60,60,0.35);
}

/* Inventarzeilen */
.inv-list .inv-row {
    display: flex;
    gap: 6px;
    margin-bottom: 6px;
    align-items: center;
}

.inv-row input {
    flex: 1;
    padding: 6px;
    background: rgba(10,4,6,0.92);
    border: 1px solid #8a5200;
    color: #fff4e6;
    border-radius: 4px;
    box-shadow:
        inset 0 0 6px rgba(0,0,0,0.9),
        inset 0 0 8px rgba(255,0,40,0.18);
}

/* Aktionstaste */
.inv-action {
    width: 100%;
    max-width: 950px;
    height: 34px;
    background: linear-gradient(90deg, #ffe9a8, #e2b44a);
    border: 2px solid #8a5200;
    border-radius: 6px;
    cursor: pointer;
    color: #111;
    font-weight: 700;
    box-shadow:
        0 0 10px rgba(255,200,80,0.85),
        0 0 14px rgba(255,60,60,0.45);
}

.uf-popup-bg {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.75);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:999;
}

.uf-popup {
    background:#120a12;
    border:2px solid gold;
    border-radius:10px;
    padding:16px;
    width:360px;
    color:#ffe7c2;
}

.uf-popup-title {
    margin-top:0;
    color:#f5d77a;
    text-align:center;
}

.uf-input {
    width:100%;
    padding:6px;
    margin:4px 0 10px 0;
    background:#1a0f1a;
    border:1px solid #8a5200;
    color:#ffe7c2;
    border-radius:4px;
}

.uf-btn {
    padding:6px 12px;
    background:#1a0f1a;
    border:1px solid #8a5200;
    color:#ffdca8;
    border-radius:4px;
    cursor:pointer;
}



/* ============================
TAP PROGRESS
============================ */
#tap-progress-container {
    width: 950px;
    margin: 18px auto 12px auto;
    background: linear-gradient(135deg, #12020a 0%, #070306 100%);
    border: 2px solid #8a5200;
    border-radius: 6px;
    padding: 8px;
    box-sizing: border-box;
    box-shadow:
        0 0 20px rgba(0,0,0,0.95),
        0 0 14px rgba(255,60,60,0.35);
}

#tap-progress-bar {
    height: 18px;
    width: 100%;
    background: linear-gradient(90deg, #4b5563, #6b7280);
    border-radius: 4px;
    transition: width 0.3s;
    box-shadow: inset 0 0 6px rgba(0,0,0,0.6);
}

#tap-progress-text {
    color: #fff4e6;
    margin-top: 6px;
    text-align: right;
    font-size: 12px;
    text-shadow:
        0 0 4px rgba(255,200,80,0.6);
}

/* ============================
TIMELINE 2x30 – Bloodcore R2 (funktionierende Version)
============================ */
#tap-timeline {
    width: 950px;
    margin: 0 auto 20px auto;
    background: linear-gradient(135deg, #3a0006 0%, #150003 45%, #000000 100%);
    border: 2px solid #8a5200;
    border-radius: 6px;
    padding: 10px;
    box-sizing: border-box;
    color: #fff4e6;
    box-shadow:
        0 0 22px rgba(0,0,0,1),
        0 0 18px rgba(255,60,60,0.45);

    display: grid;
    grid-template-columns: repeat(30, 1fr); /* 30 Felder pro Zeile */
    grid-auto-rows: 48px;                   /* Höhe jeder Zeile */
    gap: 8px;
}

/* Einzelner Tag */
.tap-day {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;

    background: rgba(10,4,6,0.92);
    border: 1px solid #8a5200;
    border-radius: 4px;
    color: #fff4e6;

    padding: 4px;
    font-size: 12px;

    box-shadow:
        inset 0 0 8px rgba(0,0,0,0.9),
        0 0 6px rgba(255,60,60,0.12);
}

/* Tagnummer */
.tap-day .day-num {
    font-weight: 700;
    color: #ffe9b4;
    margin-bottom: 2px;
    text-shadow:
        0 0 4px rgba(255,200,80,0.7),
        0 0 8px rgba(255,60,60,0.35);
}
/* optionaler Text */
.tap-day .day-text {
    font-size: 11px;
    color: #fff4e6;
    opacity: 0.95;
}

/* Hover / aktive Tage */
.tap-day:hover {
    transform: translateY(-2px);
    box-shadow:
        0 0 14px rgba(255,200,80,0.9),
        0 0 18px rgba(255,60,60,0.45);
    cursor: pointer;
}

/* Markierter Tag */
.tap-day.active {
    background: linear-gradient(90deg, #ffe9a8, #e2b44a);
    color: #111;
    border: 2px solid #8a5200;
    box-shadow:
        0 0 12px rgba(255,200,80,0.95),
        0 0 18px rgba(255,60,60,0.5);
}

/* Responsive: bei kleinen Bildschirmen horizontal scrollen */
@media (max-width: 980px) {
    #tap-timeline {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 12px;
    }
   





/* ============================
FOOTER
============================ */
#undra-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 14px;
    margin: 12px 10px 0 10px;
    background: #0a050a;
    border-top: 2px solid gold;
    border-radius: 0 0 6px 6px;
    color: #ffe7c2;
    font-size: 13px;
}

.uf-btn {
    padding: 6px 12px;
    background: rgba(20,10,12,0.9);
    border: 1px solid #8a5200;
    border-radius: 4px;
    color: #ffdca8;
    cursor: pointer;
    text-shadow: 0 0 4px rgba(255,200,80,0.6);
}

.uf-btn:hover {
    background: rgba(40,20,22,0.9);
}

#uf-center {
    display: flex;
    flex-direction: row;   /* WICHTIG */
    align-items: center;
    gap: 20px;             /* Abstand zwischen SP, ATB, Währung */
}

.uf-value {
    color: #fff4e6;
    text-shadow: 0 0 4px rgba(255,200,80,0.6);
}

.uf-label {
    color: gold;
}

.uf-popup-bg.hidden {
  display: none !important;
}

.uf-popup-bg {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
/* ============================
RESPONSIVE TWEAKS (Bloodcore R2)
============================ */
@media (max-width:1000px) {
  body { padding:12px 6px; }
  #merkmale-row, #attribute-block, #vitalWrapper, #kampfWrapper, #inventoryWrapper, #tap-timeline, #footer-container {
    width: 950px !important;
    max-width: 100% !important;
  }
  .row { grid-template-columns: repeat(2,1fr); }
}
</style>
</head>

<body>
<!-- ============================
KOPFZEILE
============================ -->
<div id="undra-header">
  <div class="undra-banner">
    <div class="undra-title">Helden‑Charakterbogen</div>
    <div class="undra-subtitle" id="undra-char-name">Charakter</div>
  </div>
</div>

<!-- ============================
TOPBAR
============================ -->
<div id="undra-topbar">
  <button class="undra-top-btn" onclick="openPopup('grunddaten')">Grunddaten</button>
  <button class="undra-top-btn" onclick="openPopup('kurzbeschreibung')">Kurzbeschreibung</button>
  <button class="undra-top-btn" onclick="openPopup('hintergruende')">Hintergründe</button>
  <button class="undra-top-btn" onclick="openPopup('inventar')">Inventar</button>
  <button class="undra-top-btn" onclick="openPopup('vornachteile')">Vor/Nachteile</button>
  <button class="undra-top-btn" onclick="openPopup('wuerfel')">Würfel</button>
  <button class="undra-top-btn" onclick="openPopup('bonis')">Bonis</button>
</div>

<!-- ============================
DREIER-LINIE
============================ -->
<div id="merkmale-row">

  <!-- Merkmale links -->
  <div id="merkmale-links">
    <div class="merk-title">KÖRPERLICHE MERKMALE</div>
    <div class="merk-list">
      <div class="merk-item"><span>Alter</span><span id="ml-age">–</span></div>
      <div class="merk-item"><span>Größe</span><span id="ml-height">–</span></div>
      <div class="merk-item"><span>Gewicht</span><span id="ml-weight">–</span></div>
      <div class="merk-item"><span>Augenfarbe</span><span id="ml-eyes">–</span></div>
      <div class="merk-item"><span>Haarfarbe</span><span id="ml-hair">–</span></div>
      <div class="merk-item"><span>Stimme</span><span id="ml-voice">–</span></div>
      <div class="merk-item"><span>Kleidung / Rüstung</span><span id="ml-armor">–</span></div>
      <div class="merk-item"><span>Besondere Merkmale</span><span id="ml-special">–</span></div>
    </div>
  </div>
  

  <!-- Portrait -->
  <div id="portrait-block">
    <div id="portrait-inner">
      <img id="portrait-img" src="" alt="Portrait">
      <div id="portrait-placeholder">PORTRAIT</div>
    </div>
  </div>

  <!-- Diagramm -->
  <div id="diagramm-block">
    <div id="diagramm-inner">
      <canvas id="radarCanvas" width="175" height="175"></canvas>
    </div>
  </div>

</div>

<!-- ============================
ATTRIBUTE-BLOCK
============================ -->
<div id="attribute-block">
  <div id="attribute-title">Basis-Attribute</div>

  <div id="attribute-grid">

    <div class="row">
      <div class="attribute-slot" data-short="MU"><span class="attr-name">Mut (MU)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="IN"><span class="attr-name">Intelligenz (IN)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="FF"><span class="attr-name">Fingerfertigkeit (FF)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="GE"><span class="attr-name">Gewandtheit (GE)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="KK"><span class="attr-name">Körperkraft (KK)</span><span class="attr-level">0</span></div>
    </div>

    <div class="row">
      <div class="attribute-slot" data-short="KB"><span class="attr-name">Körperbewusstsein (KB)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="KO"><span class="attr-name">Konstitution (KO)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="CH"><span class="attr-name">Charisma (CH)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="SS"><span class="attr-name">Sozialstatus (SS)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="GZ"><span class="attr-name">Geistiger Zustand (GZ)</span><span class="attr-level">0</span></div>
    </div>

    <div class="row">
      <div class="attribute-slot" data-short="IT"><span class="attr-name">Intuition (IT)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="AN"><span class="attr-name">Angriff (AN)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="VE"><span class="attr-name">Verteidigung (VE)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="AS"><span class="attr-name">Abwehrschlag (AS)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="FK"><span class="attr-name">Fernkampf (FK)</span><span class="attr-level">0</span></div>
    </div>

    <div class="row center-row">
      <div class="attribute-slot" data-short="TC"><span class="attr-name">Trefferchance (TC)</span><span class="attr-level">0</span></div>
      <div class="attribute-slot" data-short="TE"><span class="attr-name">Technik (TE)</span><span class="attr-level">0</span></div>
    </div>

  </div>
</div>

<!-- ============================
VITALWERTE + AUFWERTUNGEN
============================ -->
<div id="vitalWrapper">

  <!-- LINKER BLOCK: Vitalwerte -->
  <div id="vitalDisplay">
    <div class="vital-title">Vitalwerte</div>

    <div class="vital-row">
      <div class="vital-icon heart">❤️</div>
      <div class="vital-label">Leben</div>
      <div class="vital-value" id="vital-le">–</div>
    </div>

    <div class="vital-row">
      <div class="vital-icon energy">⚡</div>
      <div class="vital-label" id="vital-dyn-label">Ausdauer</div>
      <div class="vital-value" id="vital-dyn">–</div>
    </div>

    <div class="vital-row">
      <div class="vital-icon shield">🛡️</div>
      <div class="vital-label">Rüstung</div>
      <div class="vital-value" id="vital-ruest">–</div>
    </div>

    <div class="vital-row">
      <div class="vital-icon brain">🧠</div>
      <div class="vital-label">Geistige Gesundheit</div>
      <div class="vital-value" id="vital-gg">–</div>
    </div>

    <div class="vital-row">
      <div class="vital-icon target">🎯</div>
      <div class="vital-label">Trefferchance</div>
      <div class="vital-value" id="vital-tc">–</div>
    </div>
  </div>

  <!-- RECHTER BLOCK: Aufwertungen -->
  <div id="vitalBonusPanel">
    <div class="vital-title">Aufwertungen</div>

    <div class="vb-row">
      <div class="vb-label">(LE)</div>
      <div class="vb-icon">❤️</div>
      <div class="vb-crystals" data-stat="LE"></div>
      <button class="vb-upgrade" data-stat="LE">▲</button>
    </div>

    <div class="vb-row">
      <div class="vb-label">(Rüst)</div>
      <div class="vb-icon">🛡️</div>
      <div class="vb-crystals" data-stat="RUEST"></div>
      <button class="vb-upgrade" data-stat="RUEST">▲</button>
    </div>

    <div class="vb-row" id="vb-dynamic-row">
      <div class="vb-label" id="vb-dyn-label">(AU)</div>
      <div class="vb-icon" id="vb-dyn-icon">⚡</div>
      <div class="vb-crystals" data-stat="DYN"></div>
      <button class="vb-upgrade" data-stat="DYN">▲</button>
    </div>

    <div class="vb-row">
      <div class="vb-label">(GG)</div>
      <div class="vb-icon">🧠</div>
      <div class="vb-crystals" data-stat="GG"></div>
      <button class="vb-upgrade" data-stat="GG">▲</button>
    </div>

    <div class="vb-row">
      <div class="vb-label">(TC)</div>
      <div class="vb-icon">🎯</div>
      <div class="vb-crystals" data-stat="TC"></div>
      <button class="vb-upgrade" data-stat="TC">▲</button>
    </div>
  </div>

</div>

<!-- ============================
KAMPF + RÜSTUNGSSYSTEM
============================ -->
<div id="kampfWrapper">

  <!-- LINKER BLOCK: Angriffsblock -->
  <div id="angriffsBlock" class="kampf-panel">
    <div class="vital-title">Angriffsblock</div>

    <div class="kampf-row">
      <div class="kampf-label">Angriff</div>
      <div class="kampf-value" id="kampf-angriff">–</div>
    </div>

    <div class="kampf-row">
      <div class="kampf-label">Verteidigung</div>
      <div class="kampf-value" id="kampf-verteidigung">–</div>
    </div>

    <div class="kampf-row">
      <div class="kampf-label">Abwehr</div>
      <div class="kampf-value" id="kampf-abwehr">–</div>
    </div>

    <div class="kampf-row">
      <div class="kampf-label">Gegenangriff</div>
      <div class="kampf-value" id="kampf-gegenangriff">–</div>
    </div>

    <div class="kampf-row">
      <div class="kampf-label">Statusveränderung</div>
      <div class="kampf-value" id="kampf-status">–</div>
    </div>

    <div class="kampf-row">
      <div class="kampf-label">Verbesserte Anpassungen</div>
      <div class="kampf-value" id="kampf-anpassungen">–</div>
    </div>

    <div id="anmerkungBlock">
      <div class="anmerkung-title">Anmerkung</div>
      <textarea id="anmerkungText" maxlength="500"></textarea>
      <div id="anmerkungCounter">0 / 500</div>
    </div>
  </div>

  <!-- RECHTER BLOCK: Rüstungssystem -->
  <div id="ruestungsBlock">
    <div class="vital-title">Rüstungssystem</div>

    <div id="armorSystem">

      <!-- Linke Seite -->
      <div id="armorLeft">

        <div id="zoneSelectGrid">
          <div data-value="1">1. Kopf</div>
          <div data-value="2">2. Hals</div>
          <div data-value="3">3. Oberkörper</div>
          <div data-value="4">4. Linker Arm</div>
          <div data-value="5">5. Rechter Arm</div>
          <div data-value="6">6. Unterkörper</div>
          <div data-value="7">7. Linkes Bein</div>
          <div data-value="8">8. Rechtes Bein</div>
        </div>

        <input id="damageInput" type="number" placeholder="Schaden">
        <button onclick="applyDamage()">Treffer anwenden</button>
        <button onclick="openArmorPopup()">Rüstwert</button>

        <div id="zoneList"></div>
      </div>

      <!-- Rechte Seite: Figur -->
      <div id="armorRight">
        <svg id="zoneFigure" viewBox="0 0 120 360">

          <!-- Körper-Silhouette -->
          <path d="M60 10
                   C45 10, 40 25, 40 40
                   L40 70
                   C40 85, 30 95, 30 110
                   L30 160
                   C30 180, 40 200, 40 220
                   L40 260
                   C40 280, 50 300, 60 300
                   C70 300, 80 280, 80 260
                   L80 220
                   C80 200, 90 180, 90 160
                   L90 110
                   C90 95, 80 85, 80 70
                   L80 40
                   C80 25, 75 10, 60 10
                   Z"
                fill="#0d0d0d" stroke="#3a1f47" stroke-width="2"/>

          <!-- Kopf -->
          <circle id="zone1" cx="60" cy="35" r="22" class="armor-zone"/>

          <!-- Hals -->
          <rect id="zone2" x="50" y="55" width="20" height="18" rx="4" class="armor-zone"/>

          <!-- Brust -->
          <rect id="zone3" x="35" y="75" width="50" height="70" rx="10" class="armor-zone"/>

          <!-- Linker Arm -->
          <rect id="zone4" x="20" y="80" width="12" height="80" rx="6" class="armor-zone"/>

          <!-- Rechter Arm -->
          <rect id="zone5" x="88" y="80" width="12" height="80" rx="6" class="armor-zone"/>

          <!-- Unterkörper -->
          <rect id="zone6" x="45" y="150" width="30" height="40" rx="8" class="armor-zone"/>

          <!-- Linkes Bein -->
          <rect id="zone7" x="48" y="190" width="12" height="120" rx="6" class="armor-zone"/>

          <!-- Rechtes Bein -->
          <rect id="zone8" x="60" y="190" width="12" height="120" rx="6" class="armor-zone"/>
        </svg>
      </div>

    </div>
  </div>

</div>

<!-- ============================
ARMOR POPUP
============================ -->
<div id="armorPopup" class="popup-bg hidden">
  <div class="popup">
    <h3 id="popupTitle"></h3>
    <div id="popupContent"></div>
    <button onclick="confirmArmorAction()">Bestätigen</button>
    <button onclick="closeArmorPopup()">Abbrechen</button>
  </div>
</div>

<!-- ============================
POPUP: Cloud-Laden (Name + Titel)
============================ -->
<div id="uf-load-popup-bg" class="uf-popup-bg" style="display:none;">
  <div id="uf-load-popup" class="uf-popup">
    <h2 class="uf-popup-title">Charakter laden</h2>

    <label class="uf-label">Name:</label>
    <input id="uf-load-name" class="uf-input" type="text">

    <label class="uf-label">Zuname / Titel:</label>
    <input id="uf-load-title" class="uf-input" type="text">

    <div style="margin-top:12px; display:flex; justify-content:space-between;">
      <button id="uf-load-cancel" class="uf-btn">Abbrechen</button>
      <button onclick="triggerLoadChar()" class="uf-btn">Laden</button>
    </div>
  </div>
</div>


<!-- ============================
UNDRA FOOTER (NEU, BEREINIGT)
============================ -->
<div id="undra-footer">
    

  <!-- LINKS: Charakter Laden -->
  <button onclick="openLoadPopup()" class="uf-btn">Charakter laden</button>

  <!-- MITTE: SP, ATB, WÄHRUNG -->
  <div id="uf-center">

    <!-- SP -->
    <div class="uf-value">
      <span class="uf-label">SP:</span>
      <span id="uf-sp-used">0</span> /
      <span id="uf-sp-left">0</span>
    </div>

    <!-- ATB -->
    <div class="uf-value">
      <span class="uf-label">ATB:</span>
      <span id="uf-atb-used">0</span> /
      <span id="uf-atb-left">0</span>
    </div>

    <!-- WÄHRUNG -->
    <div id="uf-currency">
      <div class="uf-value">
        <span class="uf-label">Gold:</span>
        <span id="money-gold">0</span>
      </div>

      <div class="uf-value">
        <span class="uf-label">Silber:</span>
        <span id="money-silver">0</span>
      </div>

      <div class="uf-value">
        <span class="uf-label">Kupfer:</span>
        <span id="money-copper">0</span>
      </div>
    </div>

  </div>

  <!-- ============================
POPUP: SPEICHERN
============================ -->
<div id="savePopup" class="uf-popup-bg" style="display:none;">
  <div class="uf-popup">
    <h2 class="uf-popup-title">Charakter speichern</h2>

    <label class="uf-label">Name:</label>
    <input id="save-name" class="uf-input" type="text">

    <label class="uf-label">Titel:</label>
    <input id="save-title" class="uf-input" type="text">

    <div style="margin-top:12px; display:flex; justify-content:space-between;">
      <button id="save-cancel" class="uf-btn">Abbrechen</button>
      <button id="save-confirm" class="uf-btn">Speichern</button>
    </div>
  </div>
</div>

<button id="uf-save" class="uf-btn" onclick="openSavePopup()">Speichern</button>

<!-- ============================
INVENTAR POPUP (NEU, BEREINIGT)
============================ -->
<div id="popup-inventar" class="undra-popup hidden">
    
  <div class="undra-popup-inner">

    <div class="undra-popup-title">Inventar</div>

    <!-- Kategorie-Schalter -->
    <div class="inv-tabs">
      <button onclick="showInvCategory('small')" class="undra-btn">Klein</button>
      <button onclick="showInvCategory('medium')" class="undra-btn">Mittel</button>
      <button onclick="showInvCategory('large')" class="undra-btn">Groß</button>
    </div>

    <!-- Klein -->
    <div id="inv-cat-small" class="inv-category">
      <div class="inv-title">Klein</div>
      <button class="inv-sort" id="sort-small">Sortieren</button>
      <div class="inv-list" id="inv-small"></div>
    </div>

    <!-- Mittel -->
    <div id="inv-cat-medium" class="inv-category hidden">
      <div class="inv-title">Mittel</div>
      <button class="inv-sort" id="sort-medium">Sortieren</button>
      <div class="inv-list" id="inv-medium"></div>
    </div>

    <!-- Groß -->
    <div id="inv-cat-large" class="inv-category hidden">
      <div class="inv-title">Groß</div>
      <button class="inv-sort" id="sort-large">Sortieren</button>
      <div class="inv-list" id="inv-large"></div>
    </div>

    <!-- Zusammenfassung -->
    <div class="inv-summary">
      <div class="inv-row">
        <span class="inv-label">Klein:</span>
        <span class="inv-count" id="inv-small-count">0/10</span>
      </div>
      <div class="inv-row">
        <span class="inv-label">Mittel:</span>
        <span class="inv-count" id="inv-medium-count">0/10</span>
      </div>
      <div class="inv-row">
        <span class="inv-label">Groß:</span>
        <span class="inv-count" id="inv-large-count">0/10</span>
      </div>
    </div>
    <button class="undra-popup-close" onclick="closePopup('inventar')">Schließen</button>

    <!-- ============================
VERKAUFS-POPUP (EINZIGES!)
============================ -->
<div id="invSellPopup" class="uf-popup-bg hidden">
  <div class="uf-popup">
    <h2 class="uf-popup-title">Verkaufen</h2>

    <label class="uf-label">Gold:</label>
    <input id="sellGold" class="uf-input" type="number" min="0" value="0">

    <label class="uf-label">Silber:</label>
    <input id="sellSilver" class="uf-input" type="number" min="0" value="0">

    <label class="uf-label">Kupfer:</label>
    <input id="sellCopper" class="uf-input" type="number" min="0" value="0">

    <label class="uf-label">PIN:</label>
    <input id="sellPin" class="uf-input" type="password" maxlength="4">

    <div style="margin-top:12px; display:flex; justify-content:space-between;">
      <button id="sellCancelBtn" class="uf-btn">Abbrechen</button>
      <button id="sellConfirmBtn" class="uf-btn">Verkaufen</button>
    </div>
  </div>
</div>

<!-- ============================
POPUPS FÜR GRUNDDATEN / KURZBESCHREIBUNG / HINTERGRÜNDE / ETC.
(LEERE SHELLS – werden durch JS gefüllt)
============================ -->

<div id="popup-grunddaten" class="undra-popup hidden">
  <div class="undra-popup-inner">
    <div class="undra-popup-title">Grunddaten</div>
    <div id="grunddaten-content"></div>
    <button class="undra-popup-close" onclick="closePopup('grunddaten')">Schließen</button>
  </div>
</div>

<div id="popup-kurzbeschreibung" class="undra-popup hidden">
  <div class="undra-popup-inner">
    <div class="undra-popup-title">Kurzbeschreibung</div>
    <div id="kurzbeschreibung-content"></div>
    <button class="undra-popup-close" onclick="closePopup('kurzbeschreibung')">Schließen</button>
  </div>
</div>

<div id="popup-hintergruende" class="undra-popup hidden">
  <div class="undra-popup-inner">
    <div class="undra-popup-title">Hintergründe</div>
    <div id="hintergruende-content"></div>
    <button class="undra-popup-close" onclick="closePopup('hintergruende')">Schließen</button>
  </div>
</div>

<div id="popup-vornachteile" class="undra-popup hidden">
  <div class="undra-popup-inner">
    <div class="undra-popup-title">Vor- und Nachteile</div>
    <div id="vornachteile-content"></div>
    <button class="undra-popup-close" onclick="closePopup('vornachteile')">Schließen</button>
  </div>
</div>

<div id="popup-wuerfel" class="undra-popup hidden">
  <div class="undra-popup-inner">
    <div class="undra-popup-title">Würfel</div>
    <div id="wuerfel-content"></div>
    <button class="undra-popup-close" onclick="closePopup('wuerfel')">Schließen</button>
  </div>
</div>

<div id="popup-bonis" class="undra-popup hidden">
  <div class="undra-popup-inner">
    <div class="undra-popup-title">Bonis</div>
    <div id="bonis-content"></div>
    <button class="undra-popup-close" onclick="closePopup('bonis')">Schließen</button>
  </div>
</div>



<div id="invSellPopup" class="uf-popup-bg hidden">
  <div class="uf-popup">
    <h2 class="uf-popup-title">Verkaufen</h2>

    <label class="uf-label">Gold:</label>
    <input id="sellGold" class="uf-input" type="number" min="0" value="0">

    <label class="uf-label">Silber:</label>
    <input id="sellSilver" class="uf-input" type="number" min="0" value="0">

    <label class="uf-label">Kupfer:</label>
    <input id="sellCopper" class="uf-input" type="number" min="0" value="0">

    <label class="uf-label">PIN:</label>
    <input id="sellPin" class="uf-input" type="password" maxlength="4">

    <div style="margin-top:12px; display:flex; justify-content:space-between;">
      <button id="sellCancelBtn" class="uf-btn">Abbrechen</button>
      <button id="sellConfirmBtn" class="uf-btn">Verkaufen</button>
    </div>
  </div>
</div>

<div id="undra-alert" class="uf-popup-bg hidden">
  <div class="uf-popup">
    <h2 class="uf-popup-title" id="undra-alert-title">Hinweis</h2>
    <div id="undra-alert-message" style="margin: 12px 0; color:#ffe7c2;"></div>

    <div style="text-align:right;">
      <button class="uf-btn" onclick="closeUndraAlert()">OK</button>
    </div>
  </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("sellConfirmBtn").addEventListener("click", confirmSellFromPopup);
  document.getElementById("sellCancelBtn").addEventListener("click", closeSellPopup);
});
/* ============================
STATE & LOCAL STORAGE (char‑basiert)
============================ */
window.char = window.char || {};

function loadFromLocal() {
  try {
    const raw = localStorage.getItem("char");
    if (raw) {
      const parsed = JSON.parse(raw);
      if (parsed && typeof parsed === "object") {
        window.char = parsed;
        return;
      }
    }
  } catch (e) {
    console.warn("Lokale Daten ungültig, Fallback.");
  }

  // Fallback-Struktur
  window.char = {
    meta: { name: "", title: "" },
    currency: { gold: 0, silver: 0, copper: 0 },
    inventory: {
      small: Array(10).fill(""),
      medium: Array(10).fill(""),
      large: Array(10).fill("")
    },
    vitals: {},
    upgrades: {},
    zones: {
      Z1: 0, Z2: 0, Z3: 0, Z4: 0, Z5: 0, Z6: 0, Z7: 0, Z8: 0
    }
  };
}

function saveToLocal() {
  try {
    localStorage.setItem("char", JSON.stringify(window.char));
  } catch (e) {
    console.warn("Konnte lokalen Speicher nicht schreiben.", e);
  }
}

loadFromLocal();

/* ============================
CURRENCY ENGINE (char‑basiert)
============================ */
const currencyEngine = {
  gold: char.currency?.gold || 0,
  silver: char.currency?.silver || 0,
  copper: char.currency?.copper || 0,

  set(g, s, c) {
    this.gold = g || 0;
    this.silver = s || 0;
    this.copper = c || 0;

    this.render();

    char.currency.gold = this.gold;
    char.currency.silver = this.silver;
    char.currency.copper = this.copper;

    saveToLocal();
  },

  addCopper(amount) {
    let total =
      this.gold * 10000 +
      this.silver * 100 +
      this.copper +
      (amount || 0);

    this.gold = Math.floor(total / 10000);
    total %= 10000;

    this.silver = Math.floor(total / 100);
    this.copper = total % 100;

    this.set(this.gold, this.silver, this.copper);
  },

  render() {
    const g = document.getElementById("money-gold");
    const s = document.getElementById("money-silver");
    const c = document.getElementById("money-copper");

    if (g) g.textContent = this.gold;
    if (s) s.textContent = this.silver;
    if (c) c.textContent = this.copper;
  }
};

/* ============================
VITALWERTE
============================ */
function updateVitalsDisplayFromState() {
  const v = char.vitals || {};
  const u = char.upgrades || {};

  const setText = (id, value) => {
    const el = document.getElementById(id);
    if (el) el.textContent = value;
  };

  setText("vital-le", v.LE || 0);
  setText("vital-dyn", v.AU || 0);
  setText("vital-ruest", v.RUEST || 0);
  setText("vital-gg", v.GG || 0);
  setText("vital-tc", v.TC || 0);

  setText("upgrade-le", u.LE || 0);
  setText("upgrade-ruest", u.RUEST || 0);
  setText("upgrade-au", u.AU || 0);
  setText("upgrade-gg", u.GG || 0);
  setText("upgrade-tc", u.TC || 0);
}

/* ============================
INVENTAR (RENDER + VERKAUF)
============================ */
let sellContext = { category: null, index: null };

function renderInventoryColumn(container, category) {
  if (!container) return;
  container.innerHTML = "";

  let used = 0;

  for (let i = 0; i < 10; i++) {
    const row = document.createElement("div");
    row.className = "inv-row";

    const input = document.createElement("input");
    input.value = char.inventory[category][i] || "";
    input.style.flex = "1";

    if (input.value.trim() !== "") used++;

    input.addEventListener("change", () => {
      char.inventory[category][i] = input.value.trim();
      saveToLocal();
      updateInventoryCounters();
    });

    input.setAttribute("draggable", "true");

    input.addEventListener("dragstart", e => {
      e.dataTransfer.setData(
        "text/plain",
        JSON.stringify({ category, index: i })
      );
    });

    input.addEventListener("dragover", e => e.preventDefault());

    input.addEventListener("drop", e => {
      e.preventDefault();
      try {
        const data = JSON.parse(e.dataTransfer.getData("text/plain"));

        const temp = char.inventory[data.category][data.index];
        char.inventory[data.category][data.index] = char.inventory[category][i];
        char.inventory[category][i] = temp;

        saveToLocal();
        renderInventory();
      } catch (err) {
        console.warn("Fehler beim Drag&Drop im Inventar:", err);
      }
    });

    const sellBtn = document.createElement("button");
    sellBtn.className = "inv-sell-btn";
    sellBtn.textContent = "$";
    sellBtn.onclick = () => openSellPopup(category, i);

    row.appendChild(input);
    row.appendChild(sellBtn);
    container.appendChild(row);
  }

  char.inventory[category + "_used"] = used;
}

function renderInventory() {
  renderInventoryColumn(document.getElementById("inv-small"), "small");
  renderInventoryColumn(document.getElementById("inv-medium"), "medium");
  renderInventoryColumn(document.getElementById("inv-large"), "large");

  updateInventoryCounters();
}

function updateInventoryCounters() {
  const small = document.getElementById("inv-small-count");
  const medium = document.getElementById("inv-medium-count");
  const large = document.getElementById("inv-large-count");

  if (small) small.textContent = `${char.inventory.small_used || 0}/10`;
  if (medium) medium.textContent = `${char.inventory.medium_used || 0}/10`;
  if (large) large.textContent = `${char.inventory.large_used || 0}/10`;
}

/* ============================
VERKAUFS-POPUP
============================ */
function openSellPopup(category, index) {
  sellContext.category = category;
  sellContext.index = index;

  const popup = document.getElementById("invSellPopup");
  if (popup) popup.classList.remove("hidden");

  document.getElementById("sellGold").value = "0";
  document.getElementById("sellSilver").value = "0";
  document.getElementById("sellCopper").value = "0";
  document.getElementById("sellPin").value = "";
}

function closeSellPopup() {
  const popup = document.getElementById("invSellPopup");
  if (popup) popup.classList.add("hidden");
}

function confirmSellFromPopup() {
  const { category, index } = sellContext;
  if (category == null || index == null) return;

  const item = char.inventory[category][index];
  if (!item || item.trim() === "") {
    undraAlert("Kein Gegenstand in diesem Slot.");
    return;
  }

  const gold = parseInt(document.getElementById("sellGold").value || "0", 10);
  const silver = parseInt(document.getElementById("sellSilver").value || "0", 10);
  const copper = parseInt(document.getElementById("sellCopper").value || "0", 10);
  const pin = document.getElementById("sellPin").value || "";

  if ((gold + silver + copper) <= 0) {
    undraAlert("Bitte einen gültigen Preis eingeben.");
    return;
  }

  const DM_PIN = "1234";
  if (pin !== DM_PIN) {
    undraAlert("Falsche PIN.");
    return;
  }

  const totalCopper = gold * 10000 + silver * 100 + copper;
  currencyEngine.addCopper(totalCopper);

  char.inventory[category][index] = "";

  renderInventory();
  saveToLocal();

  savePage3ToCloud();

  closeSellPopup();
}

/* Event-Bindings */
document.getElementById("sellConfirmBtn").addEventListener("click", confirmSellFromPopup);
document.getElementById("sellCancelBtn").addEventListener("click", closeSellPopup);
document.addEventListener("DOMContentLoaded", () => {
  const sellConfirmBtn = document.getElementById("sellConfirmBtn");
  const sellCancelBtn = document.getElementById("sellCancelBtn");

  if (sellConfirmBtn) {
    sellConfirmBtn.addEventListener("click", confirmSellFromPopup);
  } else {
    console.warn("sellConfirmBtn nicht gefunden!");
  }

  if (sellCancelBtn) {
    sellCancelBtn.addEventListener("click", closeSellPopup);
  } else {
    console.warn("sellCancelBtn nicht gefunden!");
  }

  // Rest deiner DOM-Initialisierung …
});

/* ============================
VERKAUFS-POPUP
============================ */
function openSellPopup(category, index) {
  sellContext.category = category;
  sellContext.index = index;

  const popup = document.getElementById("invSellPopup");
  if (popup) popup.classList.remove("hidden");

  document.getElementById("sellGold").value = "0";
  document.getElementById("sellSilver").value = "0";
  document.getElementById("sellCopper").value = "0";
  document.getElementById("sellPin").value = "";
}

function closeSellPopup() {
  const popup = document.getElementById("invSellPopup");
  if (popup) popup.classList.add("hidden");
}

function confirmSellFromPopup() {
  const { category, index } = sellContext;
  if (category == null || index == null) return;

  const item = char.inventory[category][index];
  if (!item || item.trim() === "") {
    undraAlert("Kein Gegenstand in diesem Slot.");
    return;
  }

  const gold = parseInt(document.getElementById("sellGold").value || "0", 10);
  const silver = parseInt(document.getElementById("sellSilver").value || "0", 10);
  const copper = parseInt(document.getElementById("sellCopper").value || "0", 10);
  const pin = document.getElementById("sellPin").value || "";

  if ((gold + silver + copper) <= 0) {
    undraAlert("Bitte einen gültigen Preis eingeben.");
    return;
  }

  const DM_PINS = [
  "1023","3849","5561","9982","4410","7721","6304","2199","8450","1102",
  "9033","6678","1209","4788","5501","3344","9012","7780","6623","8891",
  "2301","9910","4567","8123","7004","6409","5522","1288","9901","3144",
  "2048","7777","8888","9999","1234","4321","2468","1357","8080","9090",
  "1111","2222","3333","4444","5555","6666","1212","3434","5656","7878",
  "1010","2020","3030","4040","5050","6060","7070","8081","9091","9191",
  "1717","1818","1919","2021","2121","2323","2424","2525","2626","2727",
  "2828","2929","3131","3232","3535","3636","3737","3838","3939","4041",
  "4141","4242","4343","4545","4646","4747","4848","4949","5051","5151",
  "5252","5353","5454","5657","5757","5858","5959","6061","6161","6262"
];
  if (!DM_PINS.includes(pin)) {
  undraAlert("Falsche PIN.");
  return;
}
  const totalCopper = gold * 10000 + silver * 100 + copper;
  currencyEngine.addCopper(totalCopper);

  char.inventory[category][index] = "";

  renderInventory();
  saveToLocal();

  // WICHTIG: Cloudflare-Speichern, nicht Gist!
  savePage3ToCloud();

  closeSellPopup();
}

/* ============================
ZONEN & RÜSTUNGSSYSTEM
============================ */
function renderZonesFromState() {
  const zoneList = document.getElementById("zoneList");
  if (!zoneList) return;

  const zones = char.zones || {};
  zoneList.innerHTML = "";

  for (let i = 1; i <= 8; i++) {
    const name =
      document.querySelector(`#zoneSelectGrid div[data-value="${i}"]`)
        ?.textContent || `Zone ${i}`;

    const value = zones[`Z${i}`] ?? 0;

    const row = document.createElement("div");
    row.className = "zone-row";
    row.textContent = `${name}: ${value}`;
    zoneList.appendChild(row);
  }
}

function applyDamage() {
  const selected = document.querySelector("#zoneSelectGrid .active-zone");
  const input = document.getElementById("damageInput");
  const damage = parseInt(input?.value || "0", 10);

  if (!selected || isNaN(damage)) return;

  const zoneId = selected.getAttribute("data-value");
  const key = `Z${zoneId}`;

  const zones = char.zones || {};
  zones[key] = Math.max(0, (zones[key] || 0) - damage);

  char.zones = zones;
  saveToLocal();
  renderZonesFromState();
}

function openArmorPopup() {
  const selected = document.querySelector("#zoneSelectGrid .active-zone");
  if (!selected) return;

  const zoneId = selected.getAttribute("data-value");
  const name = selected.textContent;
  const key = `Z${zoneId}`;

  const value = char.zones?.[key] ?? 0;

  document.getElementById("popupTitle").textContent = name;
  document.getElementById("popupContent").innerHTML =
    `<input id="armorValueInput" type="number" value="${value}" />`;

  document.getElementById("armorPopup").style.display = "flex";
}

function confirmArmorAction() {
  const selected = document.querySelector("#zoneSelectGrid .active-zone");
  const input = document.getElementById("armorValueInput");
  const value = parseInt(input?.value || "0", 10);

  if (!selected || isNaN(value)) return;

  const zoneId = selected.getAttribute("data-value");
  const key = `Z${zoneId}`;

  const zones = char.zones || {};
  zones[key] = value;

  char.zones = zones;
  saveToLocal();
  renderZonesFromState();
  closeArmorPopup();
}

function closeArmorPopup() {
  document.getElementById("armorPopup").style.display = "none";
}

function highlightSvgZone(zoneId) {
  document
    .querySelectorAll(".armor-zone")
    .forEach(z => z.classList.remove("active-zone-svg"));

  const svgZone = document.getElementById(`zone${zoneId}`);
  if (svgZone) svgZone.classList.add("active-zone-svg");
}

/* ============================
ATTRIBUTE-NORMALISIERUNG
============================ */
function normalizeAttributes(data) {
  const raw = data.attributes || data.attrs || data.meta?.attributes || {};

  const map = {
    MU: ["Mut", "MU"],
    FF: ["Fingerfertigkeit", "FF"],
    KK: ["Körperkraft", "KK"],
    KB: ["Körperbewusstsein", "KB"],
    CH: ["Charisma", "CH"],
    GZ: ["Geistiger Zustand", "GZ"],
    IT: ["Intuition", "IT"],
    VE: ["Verteidigung", "VE"],
    FK: ["Fernkampf", "FK"],
    IN: ["Intelligenz", "IN"],
    GE: ["Gewandtheit", "GE"],
    KO: ["Konstitution", "KO"],
    SS: ["Sozialstatus", "SS"],
    AN: ["Angriff", "AN"],
    AS: ["Abwehrschlag", "AS"],
    TC: ["Trefferchance", "TC"],
    TE: ["Technik", "TE"]
  };

  const result = {};
  for (const key in map) {
    const [long, short] = map[key];
    result[key] = raw[long] ?? raw[short] ?? 0;
  }

  data.attributes = result;
  return data;
}

/* ============================
STATE → UI (ATTRIBUTES)
============================ */
function setAttrSlot(id, value) {
  const el = document.getElementById(id);
  if (el) {
    el.textContent = value;
    return;
  }

  const slot = document.querySelector(
    `.attribute-slot[data-short="${id.replace("val-", "").toUpperCase()}"]`
  );
  if (slot) {
    const level = slot.querySelector(".attr-level");
    if (level) level.textContent = value;
    else console.warn("setAttrSlot(): .attr-level fehlt in Slot:", id);
  } else {
    console.warn("setAttrSlot(): Slot nicht gefunden für:", id);
  }
}

function undraApplyStateToPage3() {
  const a = (window.char && window.char.attributes) || {};

  setAttrSlot("val-mu", a.MU || 0);
  setAttrSlot("val-ff", a.FF || 0);
  setAttrSlot("val-kk", a.KK || 0);
  setAttrSlot("val-kb", a.KB || 0);
  setAttrSlot("val-ch", a.CH || 0);
  setAttrSlot("val-gz", a.GZ || 0);
  setAttrSlot("val-it", a.IT || 0);
  setAttrSlot("val-ve", a.VE || 0);
  setAttrSlot("val-fk", a.FK || 0);
  setAttrSlot("val-in", a.IN || 0);
  setAttrSlot("val-ge", a.GE || 0);
  setAttrSlot("val-ko", a.KO || 0);
  setAttrSlot("val-ss", a.SS || 0);
  setAttrSlot("val-an", a.AN || 0);
  setAttrSlot("val-as", a.AS || 0);
  setAttrSlot("val-tc", a.TC || 0);
  setAttrSlot("val-te", a.TE || 0);

  updateVitalsDisplayFromState();
}


/* ============================
CLOUD SAVE (FINAL)
============================ */
async function savePage3ToCloud() {
  const name = document.getElementById("save-name").value.trim();
  const title = document.getElementById("save-title").value.trim();

  if (!name || !title) {
    undraAlert("Verkauf erfolgreich.");
    return;
  }

  const filename = `undra_${name.toLowerCase()}_${title.toLowerCase()}`;
  const url = `https://undra.djdrear.workers.dev/save/${filename}`;

  const payload = {
    ...window.char,
    meta: { name, title }
  };

  console.log("💾 Speichere:", url, payload);

  try {
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const text = await res.text();
    console.log("Antwort:", text);

    if (!res.ok) {
      undraAlert("Fehler beim Speichern:\n" + text);
      return;
    }

    closeSavePopup();
    undraAlert(`Charakter "${name}" erfolgreich gespeichert.`);
  } catch (err) {
    console.error("Speicherfehler:", err);
    undraAlert("Netzwerkfehler beim Speichern.");
  }
}

function openSavePopup() {
  const popup = document.getElementById("savePopup");
  popup.style.display = "flex";

  const meta = window.char?.meta || {};
  document.getElementById("save-name").value = meta.name || "";
  document.getElementById("save-title").value = meta.title || "";
}

function closeSavePopup() {
  document.getElementById("savePopup").style.display = "none";
}

document.getElementById("save-confirm").addEventListener("click", savePage3ToCloud);
document.getElementById("save-cancel").addEventListener("click", closeSavePopup);

function openLoadPopup() {
  document.getElementById("uf-load-popup-bg").style.display = "flex";
}

function closeLoadPopup() {
  document.getElementById("uf-load-popup-bg").style.display = "none";
}

function triggerLoadChar() {
  const name = document.getElementById("uf-load-name").value.trim();
  const title = document.getElementById("uf-load-title").value.trim();

  if (!name || !title) {
    undraAlert("Bitte Name und Titel eingeben.");
    return;
  }

  closeLoadPopup();
  loadPage3FromCloud(name, title);
}

 /* ============================================================
CLOUD LOAD (FINAL)
============================================================ */

async function loadPage3FromCloud(name, title) {
  const filename = `undra_${name.trim().toLowerCase()}_${title.trim().toLowerCase()}`;
  const url = `https://undra.djdrear.workers.dev/load/${filename}`;

  console.log("🌐 Lade aus Cloud:", url);

  try {
    const res = await fetch(url);

    console.log("Status:", res.status);
    if (!res.ok) {
      const text = await res.text();
      console.warn("Fehlertext:", text);
      undraAlert(`Charakter "${name} ${title}" nicht gefunden.\n\nStatus ${res.status}\n${text}`);
      return;
    }

    let data = await res.json();
    console.log("📦 Geladene Daten (roh):", data);

    data = normalizeAttributes(data);
    console.log("📦 Geladene Daten (normalisiert):", data);

    // ======= Fallbacks =======
    data.meta = data.meta || { name, title };
    data.currency = data.currency || { gold: 0, silver: 0, copper: 0 };
    data.inventory = data.inventory || {
      small: Array(10).fill(""),
      medium: Array(10).fill(""),
      large: Array(10).fill("")
    };
    data.vitals = data.vitals || {};
    data.upgrades = data.upgrades || {};
    data.zones = data.zones || {
      Z1: 0, Z2: 0, Z3: 0, Z4: 0,
      Z5: 0, Z6: 0, Z7: 0, Z8: 0
    };

    // ⭐ WICHTIG: Merkmale-Fallback
    data.merkmale = data.merkmale || {
      age: "",
      height: "",
      weight: "",
      eyes: "",
      hair: "",
      voice: "",
      armor: "",
      special: ""
    };

    // ======= State übernehmen =======
    window.char = JSON.parse(JSON.stringify(data));
    saveToLocal();
    renderAll();

    const headerName = document.getElementById("undra-char-name");
    if (headerName && window.char.meta) {
      headerName.textContent = `${window.char.meta.name} ${window.char.meta.title}`;
    }

    undraAlert(`Charakter "${window.char.meta.name}" erfolgreich geladen.`);
  } catch (err) {
    console.error("Netzwerk-/Cloud-/Script-Fehler:", err);
    undraAlert("Fehler beim Laden aus Cloudflare / Script (Details in Konsole).");
  }
}
function updateMerkmaleDisplay() {
  const m = window.char.merkmale || {};

  document.getElementById("ml-age").textContent = m.age || "–";
  document.getElementById("ml-height").textContent = m.height || "–";
  document.getElementById("ml-weight").textContent = m.weight || "–";
  document.getElementById("ml-eyes").textContent = m.eyes || "–";
  document.getElementById("ml-hair").textContent = m.hair || "–";
  document.getElementById("ml-voice").textContent = m.voice || "–";
  document.getElementById("ml-armor").textContent = m.armor || "–";
  document.getElementById("ml-special").textContent = m.special || "–";

}
function renderAll() {
  currencyEngine.render();
  renderInventory();
  renderZonesFromState();
  updateVitalsDisplayFromState();
  undraApplyStateToPage3();

  // ⭐ Seite 3 Renderer
  updateMerkmaleDisplay();
}

/* ============================================================
POPUPS (INVENTAR)
============================================================ */

function openPopup(type) {
  switch (type) {
    case "inventar":
      document.getElementById("popup-inventar").classList.remove("hidden");
      renderInventory();
      showInvCategory("small");
      break;
  }
}

function closePopup(type) {
  const popup = document.getElementById(`popup-${type}`);
  if (popup) popup.classList.add("hidden");
}

function showInvCategory(type) {
  const all = ["small", "medium", "large"];
  all.forEach(cat => {
    const el = document.getElementById(`inv-cat-${cat}`);
    if (el) {
      el.classList.add("hidden");
      el.classList.remove("active");
    }
  });

  const active = document.getElementById(`inv-cat-${type}`);
  if (active) {
    active.classList.remove("hidden");
    active.classList.add("active");
  }
}

/* ============================================================
DOM-EVENTS
============================================================ */

document.addEventListener("DOMContentLoaded", () => {
  const cancelBtn = document.getElementById("uf-load-cancel");
  if (cancelBtn) cancelBtn.addEventListener("click", closeLoadPopup);

  const sellConfirmBtn = document.getElementById("sellConfirmBtn");
  if (sellConfirmBtn) sellConfirmBtn.addEventListener("click", confirmSellFromPopup);

  const sellCancelBtn = document.getElementById("sellCancelBtn");
  if (sellCancelBtn) sellCancelBtn.addEventListener("click", closeSellPopup);

  document.querySelectorAll("#zoneSelectGrid div").forEach(el => {
    el.addEventListener("click", () => {
      document.querySelectorAll("#zoneSelectGrid div").forEach(d => d.classList.remove("active-zone"));
      el.classList.add("active-zone");
      highlightSvgZone(el.getAttribute("data-value"));
    });
  });
    });

  document.querySelectorAll(".armor-zone").forEach(svg => {
    svg.addEventListener("click", () => {
      const zoneId = svg.id.replace("zone", "");

      document.querySelectorAll("#zoneSelectGrid div").forEach(d => d.classList.remove("active-zone"));

      const match = document.querySelector(`#zoneSelectGrid div[data-value="${zoneId}"]`);
      if (match) match.classList.add("active-zone");

      highlightSvgZone(zoneId);
    });
  });

function undraAlert(message, title = "Hinweis") {
  document.getElementById("undra-alert-title").textContent = title;
  document.getElementById("undra-alert-message").textContent = message;

  const popup = document.getElementById("undra-alert");
  popup.classList.remove("hidden");
}

function closeUndraAlert() {
  document.getElementById("undra-alert").classList.add("hidden");
}

/* ============================
EXPOSE
============================ */
window.undraApplyStateToPage3 = undraApplyStateToPage3;
window.undraUpdateVitals = updateVitalsDisplayFromState;
window.undraRenderZones = renderZonesFromState;
window.undraRenderAll = renderAll;
</script>
</body>
</html>
